<div class="container">
    <div class="row">
      <h1 class="text-center">Here are the machines</h1>
      <div class="col-xs-12">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Category</th>
                <th>Machine</th>
                <th>Available Materials</th>
                <th>Description</th>
                <th>More</th>
              </tr>
            </thead>
            <% @machines.each do |machine| %>
              <tbody>
                <tr data-toggle="collapse" data-target="#order_<%= machine.id %>" class="accordion-toggle" id="machine_row_<%= machine.id %>">
                  <td>
                    <div >
                      <%= image_tag machine.category.icon %>
                    </div>
                  </td>
                  <td>
                    <div>
                      <%= image_tag machine.workshop.maker.picture, class: "img-avatar2" %>

                      <%= machine.workshop.maker.name %>'s workshop
                      <br>
                      <%= machine.machine_model.name %>
                      <br>
                      <%= machine.workshop.address %>
                    </div>
                  </td>
                  <td>
                    <div>
                      <%= machine.materials.map(&:name).join(",") %>
                    </div>
                  </td>
                  <td>
                    <div>
                      <%= machine.description %>
                    </div>
                  </td>
                  <td></td>
                </tr>
                <tr>
                  <td colspan="12" class="hiddenRow">
                    <div class="accordion-body collapse" id="order_<%= machine.id %>">
                      <div id="map_<%= machine.id %>" class="form-order" style="width: 300px; height: 300px;"></div>
                      <div class="form-order">
                      </div>
                      <div class="form-order">
                        <%= simple_form_for(@order, url: orders_path, html: { multipart: true }) do |f| %>
                          <h3>LET'S ORDER !</h3>
                          <%#= f.association :machine_material, collection: machine.materials, label_method: :name, value_method: machine.machine_materials(:id), prompt: "Choose a material" %>
                          <%= f.input :description %>
                          <%#= f.input :machine_material_id, :label => "Material", :collection => @machine.machine_materials.materials %>
                          <%= f.hidden_field :machine_id, value: machine.id %>

                          <%= f.button :submit, "Start your project", class: "btn btn-success" %>
                        <% end %>
                      </div>

                    </div>
                  </td>
                </tr>
              </tbody>
              <%= content_for(:after_js) do %>

                <%= javascript_tag do %>
                  $(document).ready(function() {

                    $('#machine_row_<%= machine.id %>').on('click', function() {
                      var handler = Gmaps.build('Google');
                      handler.buildMap({ internal: { id: 'map_<%= machine.id %>' } }, function(){
                        var markers = handler.addMarkers(<%= raw @markers[machine.workshop.id].to_json %>);
  <!--                  // handler.bounds.extendWith(markers); -->
                        var map = handler.getMap();
                        map.setZoom(16);
                        map.setCenter(new google.maps.LatLng(<%= machine.workshop.latitude %>, <%= machine.workshop.longitude %>));
                      });
                    })
                  });
                <% end %>
              <% end %>
            <% end %>
          </table>
      </div>

        </div>






        <div class="text-center">

        </div>
      </div>
    </div>
  </div>
</div>

