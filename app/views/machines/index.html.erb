<div class="container">
    <div class="row">
      <h1 class="text-center">Here are the machines</h1>
      <div class="col-xs-12">
          <table class="table table-hover">

            <thead>
              <tr>
                <th>Category</th>
                <th>Machine</th>
                <th>Available Materials</th>
                <th>Description</th>
              </tr>
            </thead>
            <% @machines.each do |machine| %>
              <tbody>
                <tr data-toggle="collapse" data-target="#order_<%= machine.id %>" class="accordion-toggle">
                  <td>
                    <div>
                      <%= image_tag machine.category.icon %>
                    </div>
                  </td>
                  <td>
                    <div>
                      <%= machine.workshop.maker.name %>'s workshop
                      <br>
                      <%= machine.machine_model.name %>
                    </div>
                  </td>
                  <td>
                    <div>
                      <%= machine.materials.map(&:name).join(",") %>
                    </div>
                  </td>
                  <td>
                    <div>
                      <%= machine.description %>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="12" class="hiddenRow">
                    <div class="accordion-body collapse" id="order_<%= machine.id %>">
                      <div id="map" class="form-order" style="width: 500px; height: 500px;"></div>
                      <div class="form-order">
                      </div>
                      <div class="form-order">
                        <%= simple_form_for(@order, url: orders_path, html: { multipart: true }) do |f| %>
                          <h3>LET'S ORDER !</h3>
                          <%= f.association :machine_material, collection: machine.materials.map(&:name), prompt: "Choose a material" %>
                          <%= f.input :description %>
                          <%#= f.input :machine_material_id, :label => "Material", :collection => @machine.machine_materials.materials %>
                          <%= f.hidden_field :machine_id, value: machine.id %>

                          <%= f.button :submit, "Order this machine", class: "btn btn-success" %>
                        <% end %>
                      </div>

                    </div>
                  </td>
                </tr>
              </tbody>
            <% end %>
          </table>
      </div>

        </div>






        <div class="text-center">

        </div>
      </div>
    </div>
  </div>
</div>

<div id="map" style="width: 100%; height: 600px;"></div>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).on('ready', function() {
      handler = Gmaps.build('Google');
      handler.buildMap({ internal: { id: 'map' } }, function(){
        markers = handler.addMarkers(<%= raw @markers.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
      });
    })
  <% end %>
<% end %>